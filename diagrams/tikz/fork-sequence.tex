\\documentclass[tikz,border=5pt]{standalone}
\\usepackage{tikz}
\\usepackage{times}
\\usetikzlibrary{shapes,arrows,positioning,calc}

\\definecolor{usercolor}{RGB}{149,165,166}\n\\definecolor{kernelcolor}{RGB}{52,152,219}\n\\definecolor{processcolor}{RGB}{46,204,113} % Colors

\\begin{document}
\\begin{tikzpicture}[
    box/.style={rectangle, minimum width=2.5cm, minimum height=0.8cm, draw=black},
    arrow/.style={->, thick},
    label/.style={font=\\scriptsize}
]

% Title
\\node[font=\\large\\bfseries] at (5,-0.5) {Process Creation via fork() + exec()};

% Nodes
\\node[box, fill=usercolor] (parent) at (1,0) {Parent\Process};\n\\node[box, fill=processcolor] (child) at (5,0) {Child\Process};\n\\node[box, fill=usercolor] (lib) at (1,-1.5) {fork()\\libsys};\n\\node[circle, draw=black, minimum size=0.8cm, fill=usercolor] (int) at (1,-3) {INT 0x30};\n\\node[box, fill=kernelcolor] (kern) at (1,-4.5) {Kernel\\do\\_fork()};\n\\node[rectangle, draw=black, minimum width=1.5cm, minimum height=2cm, fill=processcolor] (proctab) at (3,-2.75) {\\small\\begin{tabular}{c}\\n       Process\\\\Table\\\\[0.2cm]\\\\n       Parent\\\\[0.1cm]\\\\n       Child\\n       \\end{tabular}};\n\\node[box, fill=processcolor] (exec) at (5,-1.5) {exec()\\new EIP};

% Arrows
\\draw[arrow] (parent) -- node[label, above] {sys\_fork()} (lib);\n\\draw[arrow] (lib) -- (int);\n\\draw[arrow] (int) -- node[label, above] {Ring 0} (kern);\n\\draw[arrow] (kern) -- node[label, above] {Copy context} (proctab);\n\\draw[arrow, dashed] (proctab) -- node[label, above] {Duplicate} (child);\n\\draw[arrow] (child) -- node[label, above] {Replace} (exec);

% Annotations
\\node[label] at (parent.south) {Ring 3};\n\\node[label] at (lib) {fork()\libsys};\n\\node[label] at (int) {INT 0x30};\n\\node[label] at (kern) {Kernel\do\_fork()};\n\\node[label] at (exec) {exec()\new EIP};

% Process table annotation
\\node[label, above] at (proctab.north) {Copy context};

% Child process creation annotation
\\node[label, above] at (child.north) {Duplicate};

% Child exec annotation
\\node[label, right] at (exec.east) {Replace};

% Memory state table
\\node[rectangle, draw=black, minimum width=7cm, minimum height=2cm,
       anchor=north west] at (-0.5,-6) {};

\\node[label, anchor=north west, font=\\small] at (-0.3,-6.25)
     {CPU Context Transition:};

\\node[label, anchor=west] at (0,{-6.7 - i * 0.4}) {fork(): Parent EAX=child\_pid | Child EAX=0};\n\\node[label, anchor=west] at (0,{-6.7 - i * 0.4}) {exec(): Update EIP to new program entry point};

\\end{tikzpicture}
\\end{document}
